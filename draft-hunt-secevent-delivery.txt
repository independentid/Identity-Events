



Network Working Group                                       P. Hunt, Ed.
Internet-Draft                                                    Oracle
Intended status: Standards Track                            M. Scurtescu
Expires: November 16, 2017                                        Google
                                                            May 15, 2017


                     SET Token Delivery Using HTTP
                    draft-hunt-secevent-delivery-00

Abstract

   This specification defines how a series of security event tokens
   (SETs) may be delivered to a previously registered receiver using
   HTTP GET or POST over TLS.  The specification also defines how
   delivery can be assured subject to the SET Token Receiver's need for
   assurance.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 16, 2017.

Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of




Hunt & Scurtescu        Expires November 16, 2017               [Page 1]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction and Overview . . . . . . . . . . . . . . . . . .   2
     1.1.  Notational Conventions  . . . . . . . . . . . . . . . . .   2
     1.2.  Definitions . . . . . . . . . . . . . . . . . . . . . . .   3
   2.  SET Delivery Data Plane . . . . . . . . . . . . . . . . . . .   4
     2.1.  Event Delivery Process  . . . . . . . . . . . . . . . . .   4
     2.2.  HTTP POST Delivery  . . . . . . . . . . . . . . . . . . .   6
     2.3.  Delivery using HTTP Polling . . . . . . . . . . . . . . .   8
       2.3.1.  Step 1: Polling for SETs  . . . . . . . . . . . . . .   9
       2.3.2.  Step 2: Acknowledging Sets  . . . . . . . . . . . . .  12
     2.4.  Error Response Handling . . . . . . . . . . . . . . . . .  14
     2.5.  Event Stream Verification . . . . . . . . . . . . . . . .  14
   3.  Security Considerations . . . . . . . . . . . . . . . . . . .  16
   4.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  16
   5.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  16
     5.1.  Normative References  . . . . . . . . . . . . . . . . . .  16
     5.2.  Informative References  . . . . . . . . . . . . . . . . .  17
   Appendix A.  Acknowledgments  . . . . . . . . . . . . . . . . . .  18
   Appendix B.  Change Log . . . . . . . . . . . . . . . . . . . . .  18
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  18

1.  Introduction and Overview

   This specification defines how a stream of SETs (see
   [I-D.ietf-secevent-token]) can be transmitted to a previously
   registered Event Receiver using HTTP [RFC7231] over TLS.  The
   specification defines a method to push SETs via HTTP POST and to poll
   for SETs using HTTP GET.

   This specification defines to methods of SET delivery in what is
   known as Event Streams.  The specification includes a verification
   process which tests and validates Event Stream configuration.

   This specification does not define the method by which Event Streams
   are defined, provisioned, managed, monitored, and configured and is
   out of scope of this specification.
   [[This work is TBD by the SECEVENTS WG]]

1.1.  Notational Conventions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119] . These
   keywords are capitalized when used to unambiguously specify



Hunt & Scurtescu        Expires November 16, 2017               [Page 2]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   requirements of the protocol or application features and behavior
   that affect the inter-operability and security of implementations.
   When these words are not capitalized, they are meant in their
   natural-language sense.

   For purposes of readability examples are not URL encoded.
   Implementers MUST percent encode URLs as described in Section 2.1 of
   [RFC3986] .

   Throughout this documents all figures MAY contain spaces and extra
   line-wrapping for readability and space limitations.  Similarly, some
   URI's contained within examples, have been shortened for space and
   readability reasons.

1.2.  Definitions

   This specification assumes terminology defined in the Security Event
   Token specification[I-D.ietf-secevent-token] .

   The following definitions are defined for Security Event
   distribution:

   Identity Provider
      An Identity Provider is a service provider that issues
      authentication assertions that may be used by Relying Party
      service providers to establish login sessions with users.
      Examples of Identity Providers are defined in: OpenID Connect
      [openid-connect-core] and SAML2 [saml-core-2.0].  For the purpose
      of this specification an Identity Provider also includes any
      provider of services where the compromise of an account may open
      up relying parties to attack.  For example for the purposes of
      security events, an email service provider could be considered an
      "implicit" Identity Provider.

   Relying Party
      A Relying Party is a service provider that accepts assertions from
      Identity Providers to establish sessions.  Examples of Relying
      Parties are defined in: OpenID Connect [openid-connect-core] and
      SAML2 [saml-core-2.0]

   Event Transmitter
      A service provider that delivers SETs to other providers known as
      Event Receivers.  Some examples of Event Transmitters are Identity
      Providers and Relying Parties.  An Event Transmitter is
      responsible for offering a service that allows the Event Receiver
      to check the Event Stream configuration and status known as the
      "Control Plane".




Hunt & Scurtescu        Expires November 16, 2017               [Page 3]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   Event Receiver
      A service provider that registers to receive SETs from an Event
      Transmitter and provides an endpoint to receive SETs via HTTP POST
      (known as the "Data Plane").  Some examples of Event Receivers are
      Identity Providers and Relying Parties.  Event Receivers can check
      current Event Stream configuration and status by accessing the
      Event Transmitters "Control Plane".

   Event Stream
      An Event Stream is a defined location, distribution method and
      whereby an Event Transmitter and Event Receiver exchange a pre-
      defined family of SETs.

   Event Family
      An Event Family is a URI that describes the set of events types be
      issued in an Event Stream.

   Subject
      The security subject around which a security event has occurred.
      For example, a security subject might per a user, a person, an
      email address, a service provider entity, an IP address, an OAuth
      Client, a mobile device, or any identifiable thing referenced in
      security and authorization systems.

   Event
      An event is defined to be an event as represented by a security
      event token (SET).  See [I-D.ietf-secevent-token].

   NumericDate
      A JSON numeric value representing the number of seconds from
      1970-01-01T00:00:00Z UTC until the specified UTC date/time,
      ignoring leap seconds.  This is equivalent to the IEEE Std 1003.1,
      2013 Edition [POSIX.1] definition "Seconds Since the Epoch", in
      which each day is accounted for by exactly 86400 seconds, other
      than that non-integer values can be represented.  See [RFC3339]
      for details regarding date/times in general and UTC in particular.

2.  SET Delivery Data Plane

   The data plane represents the communication channel over which a
   series of SETs are delivered to a configured Event Receiver otherwise
   known as an Event Stream.

2.1.  Event Delivery Process

   When an Event occurs, the Feed Provider constructs a SET token
   [I-D.ietf-secevent-token] that describes the event.  The SET issuer




Hunt & Scurtescu        Expires November 16, 2017               [Page 4]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   determines the Event Streams over which the SET should be distributed
   to.

   How SET Events are defined and the process by which events are
   identified for Event Receivers is out-of-scope of this specification.

   When a SET is available for a Event Receiver, the Feed Transmitter
   attempts to deliver the SET based on the Event Receiver's registered
   delivery mechanism:

   o  The Event Transmitter uses an HTTP/1.1 POST to the Event Receiver
      endpoint to deliver the SET;

   o  The Event Transmitter queues up the SET in a buffer so that an
      Event Receiver MAY poll for SETs using HTTP/1.1 GET.

   o  Or, the Feed Transmitter delivers the event through a different
      method not defined by this specification.

   Delivery of SETs MAY be delivered using one of two content formats:

   Single Event(application/jwt)
      Where SETs are delivered one at a time (e.g. such as typical with
      HTTP POST) where the data payload is just a JSON Web Token
      [RFC7519] (see xxxxxxx).

   Multi-Event(application/secevents+json)  Where multiple SETs are
      delivered in a JSON structure (see xxxxxxxx).  The use of Multi-
      Event format is typically used with delivery methods that poll
      based on a timeout or schedule (e.g.  HTTP GET).

   After successful delivery of SETs, Feed Transmitters SHOULD NOT be
   required to maintain or record SETs for recovery.  Once a SET is
   delivered, the Event Receiver SHALL be responsible for retention and
   recovery.

   Transmitted SETs SHOULD be self-validating (e.g. signed) in order to
   verify they were issued by the Event Transmitter at a later date when
   de-coupled from the original delivery via HTTP where authenticity
   could be checked via the HTTP or TLS mutual authentication.

   If delivery to any particular Event Receiver has been delayed for an
   extended period of time, the Feed Transmitter MAY suspend the
   affected Event Stream and even stop maintaining outstanding SETs for
   the Event Receiver at its discretion and available resources.  The
   method by which the Event Receiver discovers and recovers these SETs
   is out of scope of this specification.




Hunt & Scurtescu        Expires November 16, 2017               [Page 5]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   Upon receiving a SET, the Event Receiver reads the SET and validates
   it.  The receiver MUST then inform the Event transmitter, using the
   defined method of any authentication, configuration, parsing or JWT
   validation errors that occur.

   Based upon the content of the token, the Event Receiver decides what,
   if any, action needs to be taken in response to the received SET.
   For example, in response to a SCIM provisioning event [idevent-scim]
   indicating a changed resource, the Event Receiver might perform a
   SCIM GET request (see Section 3.4 [RFC7644]) to the affected resource
   URI in order to confidentially obtain the current state of the
   transmitter's affected SCIM resource in order to reconcile local
   corresponding state changes.

   The action a Event Receiver takes in response to a SET MAY be
   substantially different than merely copying the action of the SET
   issuer.  A single SET can trigger one or more receiver actions or it
   can be ignored.  For example, upon receiving notification that a user
   resource has been added to a group, the Event Receiver may first
   determine that the user does not exist in the Event Receiver's
   domain.  The Event Receiver translates the event into two actions:

   1.  Retrieve the user (e.g. using SCIM GET) and then provisions the
       user locally.  After enabling the user,

   2.  The Event Receiver then enables the user for the application
       associated with membership in the issuer's group.

   The Event Receiver SHALL NOT use the Event acknowledgement mechanism
   to report Event errors other than related to the validation and
   parsing of the SET token itself.

2.2.  HTTP POST Delivery

   This method allows an Event Transmitter to use HTTP POST
   (Section 4.3.3 [RFC7231]) to deliver SETs to the registered web
   callback URI identified in the Event Stream configuration.

   The SET to be delivered MAY be signed and/or encrypted as defined in
   [I-D.ietf-secevent-token].

   The Event Stream configuration defines a URI the of an Event Receiver
   provided endpoint which accepts HTTP POST requests (e.g.
   "https://notify.examplerp.com/Events").

   The HTTP Content-Type (see Section 3.1.1.5 [RFC7231]) for the HTTP
   POST is "application/jwt" and SHALL consist of a single SET token




Hunt & Scurtescu        Expires November 16, 2017               [Page 6]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   (see [I-D.ietf-secevent-token]).  As per Section 5.3.2 [RFC7231], the
   expected media type ("Accept" header) response is "application/json".

   To deliver an event, the Event Transmitter generates an event
   delivery message and uses HTTP POST to the configured endpoint with
   the appropriate "Accept" and "Content-Type" headers.

   POST /Events  HTTP/1.1

   Host: notify.examplerp.com
   Accept: application/json
   Content-Type: application/jwt
   "eyJhbGciOiJub25lIn0
   .
   eyJwdWJsaXNoZXJVcmkiOiJodHRwczovL3NjaW0uZXhhbXBsZS5jb20iLCJmZWV
   kVXJpcyI6WyJodHRwczovL2podWIuZXhhbXBsZS5jb20vRmVlZHMvOThkNTI0Nj
   FmYTViYmM4Nzk1OTNiNzc1NCIsImh0dHBzOi8vamh1Yi5leGFtcGxlLmNvbS9GZ
   WVkcy81ZDc2MDQ1MTZiMWQwODY0MWQ3Njc2ZWU3Il0sInJlc291cmNlVXJpcyI6
   WyJodHRwczovL3NjaW0uZXhhbXBsZS5jb20vVXNlcnMvNDRmNjE0MmRmOTZiZDZ
   hYjYxZTc1MjFkOSJdLCJldmVudFR5cGVzIjpbIkNSRUFURSJdLCJhdHRyaWJ1dG
   VzIjpbImlkIiwibmFtZSIsInVzZXJOYW1lIiwicGFzc3dvcmQiLCJlbWFpbHMiX
   SwidmFsdWVzIjp7ImVtYWlscyI6W3sidHlwZSI6IndvcmsiLCJ2YWx1ZSI6Impk
   b2VAZXhhbXBsZS5jb20ifV0sInBhc3N3b3JkIjoibm90NHUybm8iLCJ1c2VyTmF
   tZSI6Impkb2UiLCJpZCI6IjQ0ZjYxNDJkZjk2YmQ2YWI2MWU3NTIxZDkiLCJuYW
   1lIjp7ImdpdmVuTmFtZSI6IkpvaG4iLCJmYW1pbHlOYW1lIjoiRG9lIn19fQ
   .

                    Figure 1: Example HTTP POST Request

   Upon receipt of the request, the Event Receiver SHALL validate the
   JWT structure of the SET as defined in Section 7.2 [RFC7519].  The
   Event Receiver SHALL also validate the SET information as described
   in Section 2 [I-D.ietf-secevent-token].

   If the SET is determined to be valid, the Event Receiver SHALL
   indicate successful submission by responding with HTTP Status 202 as
   "Accepted" (see Section 6.3.3 [RFC7231]).

   The following is a non-normative example of a successful receipt of a
   SET.

   HTTP/1.1 202 Accepted

              Figure 2: Example Successful Delivery Response

   In the event of a general HTTP error condition, the Event Receiver
   MAY respond with an appropriate HTTP Status code as defined in
   Section 6 [RFC7231].



Hunt & Scurtescu        Expires November 16, 2017               [Page 7]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   When the Event Receiver detects an error parsing and validating a
   received SET, the Event Receiver SHALL indicate an HTTP Status 400
   error with an error code as described in Section 2.4.

   The following is an example non-normative Bad Request error.

   HTTP/1.1 400 Bad Request
   Content-Type: application/json

   {
     "err":"dup",
     "description":"SET already received. Ignored."

   }

                Figure 3: Example HTTP Status 400 Response

2.3.  Delivery using HTTP Polling

   This method allows an Event Receiver to use HTTP GET (Section 4.3.1
   [RFC7231]) to check for and receive zero or more SETs at a periodic
   interval.  To acknowledge receipt of provided SETs, the Event
   Receiver performs an HTTP POST to acknowledge successful transfer of
   SETs and/or to indicate appropriate errors as specified in
   Section 2.3.2.

   This SET delivery method is primarily provided to support Event
   Receivers located behind firewalls and are not able to open HTTP
   endpoints to receive HTTP POST requests.  For the purposes of this
   delivery method, it is assumed there is a single Event Receiver
   entity performing event polling.  Considerations for multi-threaded
   polling are out of scope of this SET delivery method.

   SETs to be delivered MAY be signed and/or encrypted as defined in
   [I-D.ietf-secevent-token].

   The delivery of SETs in this method is facilitated by a two-step
   method initiated by Event Receivers:

   1.  The Event Receiver polls for available SETs using an HTTP GET to
       a pre-arranged endpoint provided by the Event Transmitter.

   2.  If any SETs are received in step 1, the Event Receiver
       acknowledges the SETs, using an HTTP POST to the same endpoint
       used to previously poll for SETs.






Hunt & Scurtescu        Expires November 16, 2017               [Page 8]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


2.3.1.  Step 1: Polling for SETs

   The Event Receiver performs an HTTP GET to a pre-arranged polling
   endpoint URI to check for any new or unacknowledged SETs that are
   available.

   The following polling parameters are supported:

   maxEvents
      an integer value indicating the maximum number of unacknowledged
      SETs that SHOULD be returned.  If more than the maximum number of
      SETs are available, the oldest SETs available SHOULD be returned
      first.

   since
      An optional integer NumericDate value that indicates the oldest
      time of unacknowledged SETs to be returned.

   before
      An optional integer NumericDate value that indicates the earliest
      time of unacknowledged SETs to be returned.

   returnImmediately
      A boolean value which indicates if the Event Transmitter SHALL
      return a response immediately if no results are available.  The
      default value is "false" indicating the request will wait pending
      availability of a SET or until the request times out.  The time
      out for the request is part of the Stream configuration which is
      out of scope of this specification.

   In order to support multi-threaded polling, an Event Transmitter MAY
   choose to track undelivered versus unacknowledged SETs internally.
   When multiple Event Receiver threads poll simultaneously, the Event
   Transmitter typically returns the maximum number of SETs allowed in a
   response to the first thread request received.  Each subsequent
   request receives the next batch of SETs and so on.

   To facilitate recovery of unacknowledged SETs, the Event Receiver MAY
   use the parameter "before" and/or "since".  Upon receipt of a request
   with these parameters, the Event Transmitter SHALL attempt to return
   all unacknowledged SETs, regardless of whether the Event Transmitter
   believes they were previously distributed.  Previously acknowledged
   SETS (see Section 2.3.2) are not typically returned and SHOULD NOT be
   recoverable.

   [[TBD: WG to discuss merits of multi-threaded and recovery support
   and protocol signalling requirements.]]




Hunt & Scurtescu        Expires November 16, 2017               [Page 9]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   The following is a non-normative example poll request to the
   endpoint: "https://nofity.exampleidp.com/Events".

   GET /Events?returnImmediately=true&since=1458496025  HTTP/1.1

   Host: notify.exampleidp.com
   Accept: application/json
   Authorization: Bearer h480djs93hd8

                      Figure 4: Example Poll Request

   In response to the HTTP GET, the Event Transmitter checks for
   available SET events and responds with a JSON document containing the
   following attributes:

   sets
      A required JSON attribute whose value is a JSON object that
      contains zero or more nested JSON attributes.  Each nested
      attribute corresponds to the "jti" of a SET to be delivered and
      whose value is a JSON String containing the value of the encoded
      corresponding SET.  If there are no outstanding SETs to be
      transmitted, the JSON object SHALL be empty.

   since
      An optional JSON attribute whose integer value is a NumericDate
      and indicates the time of the oldest SET that was returned.

   before
      An optional JSON attribute whose integer value is a NumericDate
      and indicates the time of the youngest SET that was returned.

   moreAvailable
      An optional JSON attribute whose boolean value indicates if more
      unacknowledged SETs are available to be returned.

















Hunt & Scurtescu        Expires November 16, 2017              [Page 10]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   The following is a non-normative example response to the request
   shown Figure 4.

  HTTP/1.1 200 OK
  Content-Type: application/json
  Location: https://notify.exampleidp/Events

  {
  "sets":{
    "4d3559ec67504aaba65d40b0363faad8":
     "eyJhbGciOiJub25lIn0.
     eyJqdGkiOiI0ZDM1NTllYzY3NTA0YWFiYTY1ZDQwYjAzNjNmYWFkOCIsImlhdCI6MTQ
     1ODQ5NjQwNCwiaXNzIjoiaHR0cHM6Ly9zY2ltLmV4YW1wbGUuY29tIiwiYXVkIjpbIm
     h0dHBzOi8vc2NpbS5leGFtcGxlLmNvbS9GZWVkcy85OGQ1MjQ2MWZhNWJiYzg3OTU5M
     2I3NzU0IiwiaHR0cHM6Ly9zY2ltLmV4YW1wbGUuY29tL0ZlZWRzLzVkNzYwNDUxNmIx
     ZDA4NjQxZDc2NzZlZTciXSwiZXZlbnRzIjp7InVybjppZXRmOnBhcmFtczpzY2ltOmV
     2ZW50OmNyZWF0ZSI6eyJyZWYiOiJodHRwczovL3NjaW0uZXhhbXBsZS5jb20vVXNlcn
     MvNDRmNjE0MmRmOTZiZDZhYjYxZTc1MjFkOSIsImF0dHJpYnV0ZXMiOlsiaWQiLCJuY
     W1lIiwidXNlck5hbWUiLCJwYXNzd29yZCIsImVtYWlscyJdfX19.",
    "3d0c3cf797584bd193bd0fb1bd4e7d30":
     "eyJhbGciOiJub25lIn0.
     eyJqdGkiOiIzZDBjM2NmNzk3NTg0YmQxOTNiZDBmYjFiZDRlN2QzMCIsImlhdCI6MTQ
     1ODQ5NjAyNSwiaXNzIjoiaHR0cHM6Ly9zY2ltLmV4YW1wbGUuY29tIiwiYXVkIjpbIm
     h0dHBzOi8vamh1Yi5leGFtcGxlLmNvbS9GZWVkcy85OGQ1MjQ2MWZhNWJiYzg3OTU5M
     2I3NzU0IiwiaHR0cHM6Ly9qaHViLmV4YW1wbGUuY29tL0ZlZWRzLzVkNzYwNDUxNmIx
     ZDA4NjQxZDc2NzZlZTciXSwic3ViIjoiaHR0cHM6Ly9zY2ltLmV4YW1wbGUuY29tL1V
     zZXJzLzQ0ZjYxNDJkZjk2YmQ2YWI2MWU3NTIxZDkiLCJldmVudHMiOnsidXJuOmlldG
     Y6cGFyYW1zOnNjaW06ZXZlbnQ6cGFzc3dvcmRSZXNldCI6eyJpZCI6IjQ0ZjYxNDJkZ
     jk2YmQ2YWI2MWU3NTIxZDkifSwiaHR0cHM6Ly9leGFtcGxlLmNvbS9zY2ltL2V2ZW50
     L3Bhc3N3b3JkUmVzZXRFeHQiOnsicmVzZXRBdHRlbXB0cyI6NX19fQ."
   },
   "since":1458496025
  }

                      Figure 5: Example Poll Response

   In the above example, a two SETs whose "jti" are
   "4d3559ec67504aaba65d40b0363faad8" and
   "3d0c3cf797584bd193bd0fb1bd4e7d30" are delivered.












Hunt & Scurtescu        Expires November 16, 2017              [Page 11]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   The following is a non-normative example response to the request
   shown Figure 4 showing no new SETs are available.

   HTTP/1.1 200 OK
   Content-Type: application/json
   Location: https://notify.exampleidp/Events

   {
    "sets":{ },
    "since":1458496025
   }

                  Figure 6: Example No SETs Poll Response

   Upon receiving the JSON document, the Event Receiver parses and
   verifies the received SETs and notifies the Event Transmitter via an
   HTTP POST back to the Event Transmitter as described in
   Section 2.3.2.

2.3.2.  Step 2: Acknowledging Sets

   Upon receiving SETs from the Event Transmitter, the Event Receiver
   SHALL parse the JSON document received, and validate each SET
   received and SHALL acknowledge receipt in a timely (e.g. minutes)
   fashion so that the Event Transmitter may mark the SETs as received.
   If necessary, Event Receivers SHOULD acknowledge receipt before
   taking any local actions based on the SETs to avoid unnecessary delay
   in acknowledgement where possible.

   In the case where no SETs were received in a previous poll (see
   Figure 6), the Event Receiver SHALL NOT perform any acknowledgment.

   To acknowledge receipt of SETs, the Event Receiver SHALL use HTTP
   POST to the same endpoint it previously retrieved the SETs from to
   deliver a JSON document containing the following JSON attributes:

   ack  Which contains an array of Strings that each correspond to the
      "jti" of a successfully received SET.  If there are no outstanding
      SETs to acknowledge, the attribute MAY be omitted.  When
      acknowledging a SET, the Event Transmitter is released from any
      obligation to retain the SET (e.g. for a future re-try to
      receive).

   errs  Whose value is a JSON Object that contains one or more nested
      JSON attributes that correspond to the "jti" of each invalid SET
      received.  The value of each is a JSON object whose contents is an
      _err_ attribute and _description_ attribute whose value correspond
      to the errors described in Section 2.4.



Hunt & Scurtescu        Expires November 16, 2017              [Page 12]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   The following is a non-normative example acknowledgement to the SETs
   received in Figure 5.

   POST /Events  HTTP/1.1

   Host: notify.exampleidp.com
   Content-Type: application/json
   Authorization: Bearer h480djs93hd8

   {
     "ack":[
       "4d3559ec67504aaba65d40b0363faad8",
       "3d0c3cf797584bd193bd0fb1bd4e7d30"
     ]
   }

             Figure 7: Example Poll Acknowledgement No Errors

   The following is a non-normative example error acknowledgement to the
   SETs received in Figure 5.

   POST /Events  HTTP/1.1

   Host: notify.exampleidp.com
   Content-Type: application/json
   Authorization: Bearer h480djs93hd8

   {
     "ack":["3d0c3cf797584bd193bd0fb1bd4e7d30"],
     "setErrs":{
       "4d3559ec67504aaba65d40b0363faad8":{
         "err":"jwtAud",
         "description":"The audience value was incorrect."
       }
     }
   }

             Figure 8: Example Poll Acknowledgement With Error

   In response to the acknowledgement POST request, the Event
   Transmitter SHOULD respond with HTTP Status 202 (Accepted) if the
   acknowledgement is accepted, or another appropriate HTTP response as
   defined in Section 6 [RFC7231].








Hunt & Scurtescu        Expires November 16, 2017              [Page 13]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


2.4.  Error Response Handling

   If a SET is invalid, the following error codes are defined:

   +-----------+-------------------------------------------------------+
   | Err Value | Description                                           |
   +-----------+-------------------------------------------------------+
   | jwtParse  | Invalid or unparsable JWT or JSON structure.          |
   | jwtHdr    | In invalid JWT header was detected.                   |
   | jwtCrypto | Unable to parse due to unsupported algorithm.         |
   | jws       | Signature was not validated.                          |
   | jwe       | Unable to decrypt JWE encoded data.                   |
   | jwtAud    | Invalid audience value.                               |
   | jwtIss    | Issuer not recognized.                                |
   | setType   | An unexpected event type was received.                |
   | setParse  | Invalid structure was encountered such as inability   |
   |           | to parse SET event payload.                           |
   | setData   | SET event claims incomplete or invalid.               |
   | dup       | A duplicate SET was received and has been ignored.    |
   +-----------+-------------------------------------------------------+

                            Table 1: SET Errors

   An error response SHALL include a JSON object which provides details
   about the error.  The JSON object includes the JSON attributes:

   err
      A value which is a keyword that describes the error (see Table 1).

   description
      A human-readable text that provides additional diagnostic
      information.

   When included as part of an HTTP Status 400 response, the above JSON
   is the HTTP response body (see Figure 3).  When included as part of a
   batch of SETs, the above JSON is included as part of the "setErrs"
   attribute as defined in Section 2.3.2

2.5.  Event Stream Verification

   To confirm an Event Stream configuration, the Event Transmitter SHALL
   send a verification SET to the Event Receiver using the registered
   "methodUri" mechanism which in this case is
   "urn:ietf:params:set:method:HTTP:webCallback".

   The Verify SET contains the following attributes:

   events  Set with a value of "[[this RFC URL]]#verify".



Hunt & Scurtescu        Expires November 16, 2017              [Page 14]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   iss  Set to the URI defined in the Event Stream configuration.

   aud  MUST be set to a value that matches the EventStream "aud" value
      agreed to.

   exp  A value that indicates the time the verification request will
      expire.  Once expired, the server will set the Event Stream state
      to "fail".

   If the Event Stream "confidentialJWK" value was supplied, then the
   SET SHOULD be encrypted with the provided key.  Successful parsing of
   the message confirms that provides confirmation of correct
   configuration and possession of keys.

   A payload attribute "confirmChallenge" is provided with a JSON String
   value that the Event Receiver SHALL echo back in its response.  The
   intent is to confirm that the Event Receiver has successfully parsed
   the SET and is not just echoing back HTTP success.

   A non-normative JSON representation of an event to be sent to a Event
   Receiver as a Event Stream confirmation.  Note the event is not yet
   encoded as a JWT token:

   {
     "jti": "4d3559ec67504aaba65d40b0363faad8",
     "events":["[[this RFC URL]]#verify"],
     "iat": 1458496404,
     "iss": "https://scim.example.com",
     "exp": 1458497000,
     "aud":[
      "https://scim.example.com/Feeds/98d52461fa5bbc879593b7754",
      "https://scim.example.com/Feeds/5d7604516b1d08641d7676ee7"
     ],
     "[[this RFC URL]]#verify":{
       "confirmChallenge":"ca2179f4-8936-479a-a76d-5486e2baacd7"
     }
   }

             Figure 9: Example Verification SET with Challenge

   The above SET is encoded as a JWT and transmitted to the Event
   Receiver as shown in Figure 1.

   Upon receiving a verify SET, the Event Receiver SHALL respond with a
   JSON object that includes a "challengeResponse" attribute and the
   value that was provided in "confirmChallenge".  The content type
   header is set to "application/json".




Hunt & Scurtescu        Expires November 16, 2017              [Page 15]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   The following is a non-normative example response to a Verify SET
   received via HTTP/1.1 POST and includes a JSON object containing the
   confirmation attribute and value.

   HTTP/1.1 200 OK
   Content-Type: application/json

   {
     "challengeResponse":"ca2179f4-8936-479a-a76d-5486e2baacd7"
   }

         Figure 10: Example Response to Verify SET with Challenge

   If the Event Receiver returns a non-matching value or an HTTP status
   other than a 200 series response, the Event Stream "state" SHALL be
   set to "fail".  A declining Event Receiver MAY simply respond with
   any 400 series HTTP error (e.g. 404).

3.  Security Considerations

   [TO BE COMPLETED]

4.  IANA Considerations

   [TO BE COMPLETED]

5.  References

5.1.  Normative References

   [I-D.ietf-secevent-token]
              Hunt, P., Denniss, W., Ansari, M., and M. Jones, "Security
              Event Token (SET)", draft-ietf-secevent-token-00 (work in
              progress), January 2017.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC3986]  Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform
              Resource Identifier (URI): Generic Syntax", STD 66,
              RFC 3986, DOI 10.17487/RFC3986, January 2005,
              <http://www.rfc-editor.org/info/rfc3986>.

   [RFC5988]  Nottingham, M., "Web Linking", RFC 5988,
              DOI 10.17487/RFC5988, October 2010,
              <http://www.rfc-editor.org/info/rfc5988>.



Hunt & Scurtescu        Expires November 16, 2017              [Page 16]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   [RFC7231]  Fielding, R., Ed. and J. Reschke, Ed., "Hypertext Transfer
              Protocol (HTTP/1.1): Semantics and Content", RFC 7231,
              DOI 10.17487/RFC7231, June 2014,
              <http://www.rfc-editor.org/info/rfc7231>.

   [RFC7517]  Jones, M., "JSON Web Key (JWK)", RFC 7517,
              DOI 10.17487/RFC7517, May 2015,
              <http://www.rfc-editor.org/info/rfc7517>.

   [RFC7519]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", RFC 7519, DOI 10.17487/RFC7519, May 2015,
              <http://www.rfc-editor.org/info/rfc7519>.

5.2.  Informative References

   [idevent-scim]
              Oracle Corporation, "SCIM Event Extensions (work in
              progress)".

   [openid-connect-core]
              NRI, "OpenID Connect Core 1.0", Nov 2014.

   [POSIX.1]  Institute of Electrical and Electronics Engineers, "The
              Open Group Base Specifications Issue 7", IEEE Std 1003.1,
              2013 Edition, 2013.

   [RFC3339]  Klyne, G. and C. Newman, "Date and Time on the Internet:
              Timestamps", RFC 3339, DOI 10.17487/RFC3339, July 2002,
              <http://www.rfc-editor.org/info/rfc3339>.

   [RFC7515]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web
              Signature (JWS)", RFC 7515, DOI 10.17487/RFC7515, May
              2015, <http://www.rfc-editor.org/info/rfc7515>.

   [RFC7516]  Jones, M. and J. Hildebrand, "JSON Web Encryption (JWE)",
              RFC 7516, DOI 10.17487/RFC7516, May 2015,
              <http://www.rfc-editor.org/info/rfc7516>.

   [RFC7643]  Hunt, P., Ed., Grizzle, K., Wahlstroem, E., and C.
              Mortimore, "System for Cross-domain Identity Management:
              Core Schema", RFC 7643, DOI 10.17487/RFC7643, September
              2015, <http://www.rfc-editor.org/info/rfc7643>.

   [RFC7644]  Hunt, P., Ed., Grizzle, K., Ansari, M., Wahlstroem, E.,
              and C. Mortimore, "System for Cross-domain Identity
              Management: Protocol", RFC 7644, DOI 10.17487/RFC7644,
              September 2015, <http://www.rfc-editor.org/info/rfc7644>.




Hunt & Scurtescu        Expires November 16, 2017              [Page 17]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   [saml-core-2.0]
              Internet2, "Assertions and Protocols for the OASIS
              Security Assertion Markup Language (SAML) V2.0", March
              2005.

Appendix A.  Acknowledgments

   The editors would like to thanks the members of the SCIM WG which
   began discussions of provisioning events starting with: draft-hunt-
   scim-notify-00 in 2015.

   The editor would like to thank the participants in the the SECEVENTS
   working group for their support of this specification.

Appendix B.  Change Log

   Draft 00 - PH - First Draft based on reduced version of draft-hunt-
   idevent-distribution

   Draft 01 - PH -

   o  Reworked terminology to match new WG Transmitter/Receiver terms

   o  Reworked sections into Data Plane vs. Control Plane

   o  Removed method transmission registry in order to simplify the
      specification

   o  Made Create, Update operations optional for Control Plane (Read is
      MTI)

   Draft 02 - PH

   o  Added iss metadata for Event Stream

   o  Changed to using JWKS_uri for issuer and receiver.

   o  Control Plane sections moved to draft-hunt-secevent-stream-mgmt

   o  Added support for delivering multiple events using HTTP GET
      polling

Authors' Addresses

   Phil Hunt (editor)
   Oracle Corporation

   Email: phil.hunt@yahoo.com



Hunt & Scurtescu        Expires November 16, 2017              [Page 18]

Internet-Draft      draft-hunt-secevent-distribution            May 2017


   Marius Scurtescu
   Google

   Email: mscurtescu@google.com















































Hunt & Scurtescu        Expires November 16, 2017              [Page 19]
